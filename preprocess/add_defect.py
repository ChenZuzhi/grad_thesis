import numpy as npimport cv2 as cvclass AddDefect(object):	def __init__(self, m, n):		self.m = m # ordinal of background picture		self.n = n # ordinal of defect picture		self.img = cv.imread('./origin_images/'+str(self.m)+'.png')		self.draw = self.img		self.row, self.col, chl = self.img.shape			def get_point(self):		# randomly choose a point in the image		edge = 20		x = int(np.random.uniform(edge, self.row-edge))		y = int(np.random.uniform(edge, self.col-edge))		return x,y		def get_channel(self,x,y):		return self.img[x,y]	def light_dark(channel):		# light return  1		# dark  return  0		a = np.asscalar(channel[0])		b = np.asscalar(channel[1])		c = np.asscalar(channel[2])				if sum([a,b,c])>256*3/2:			return 1		else:			return 0			def dark_color(self):		# return a dark color channel		a = np.random.uniform(1,256/4)		b = np.random.uniform(1,256/4)		c = np.random.uniform(1,256/4)		return int(a),int(b),int(c)			def light_color(self):		# return a light color channel		a = np.random.uniform(256*3/4,255)		b = np.random.uniform(256*3/4,255)		c = np.random.uniform(256*3/4,255)		return int(a),int(b),int(c)			def random_color(self):		# return a random color channel		a = np.random.uniform(1,255)		b = np.random.uniform(1,255)		c = np.random.uniform(1,255)		return int(a),int(b),int(c)		def defect_color(self,light,dark):		# randomly generate a defect color channel		# the shares of light color,		# dark color and random color		# are light:dark:random color		rd = np.random.uniform(0,1)		if rd<light:			a,b,c = self.light_color()		elif rd>(1-dark):			a,b,c = self.dark_color()		else:			a,b,c = self.random_color()		return a,b,c		def get_slope(self):		# randomly get a slope value		x = np.random.uniform(0,np.pi*4)		y = np.tan(x)		return y		def add_dot(self):		x,y = self.get_point()		r = int(np.random.uniform(4, 10))		a,b,c = self.defect_color(0.3,0.3)				cv.circle(self.draw, (x, y), r, (a,b,c), -1)		self.name = "./generated_images/dot/dot_"+str(self.n)+".png"		cv.imwrite(self.name, self.draw)		cv.destroyAllWindows()	def add_spot(self):	# note the last input in cv.circle()		x,y = self.get_point()		a,b,c = self.defect_color(0.45,0.45)		array_x = []		array_y = []		df_range = int(abs(np.random.normal(4,0.01)))		r = int(np.random.uniform(2,4))		for i in range(1, df_range**2):			df_x = int(np.random.normal(x,df_range))			df_y = int(np.random.normal(y,df_range))			cv.circle(self.draw, (df_x, df_y), r, (a,b,c), 2)						array_x.append(df_x)			array_y.append(df_y)					max_x = np.amax(array_x)		min_x = np.amin(array_x)		max_y = np.amax(array_y)		min_y = np.amin(array_y)				# smooth the image around the defect, using filtering		offset = 5		roi_img = self.draw[(min_y - offset):(max_y +offset), (min_x - offset):(max_x + offset)]		roi_img = cv.blur(roi_img, (3, 3))		self.draw[(min_y - offset):(max_y +offset), (min_x - offset):(max_x + offset)] = roi_img		self.name = "./generated_images/spot/spot_"+str(self.n)+".png"		cv.imwrite(self.name, self.draw)				cv.destroyAllWindows()		def add_cut(self):		# cuts may comes from glue overflow		# or sharp object scratch		x0,y0 = self.get_point()		r = int(np.random.uniform(1, 3))		a,b,c = self.defect_color(0.8,0.1)		k = self.get_slope()						s = 3		x = x0		y = y0		while x>=0 and x<=self.row and y>=0 and y<=self.col:			# extend line along the direction of slope			# while the point in the image			cv.circle(self.draw, (int(x),int(y)), r, (a,b,c), -1)			dx = np.random.uniform(0,1)/np.sqrt(k**2+1)*r			x += dx+np.random.normal(0,r/s)			y += dx*k+np.random.normal(0,r/s)			"""			# blur the nearby area			offset = 2*r			roi_img = self.draw[(int(y) - offset):(int(y) +offset), (int(x) - offset):(int(x)+ offset)]			roi_img = cv.blur(roi_img, (r, r))			self.draw[(int(y) - offset):(int(y) +offset), (int(x) - offset):(int(x)+ offset)] = roi_img			"""					x = x0		y = y0			while x>=0 and x<=self.row and y>=0 and y<=self.col:			# opposite direction			cv.circle(self.draw, (int(x), int(y)), r, (a,b,c), -1)			dx = -np.random.uniform(0,1)/np.sqrt(k**2+1)*r			x += dx+np.random.normal(0,r/s)			y += dx*k+np.random.normal(0,r/s)				self.name = "./generated_images/cut/cut_"+str(self.n)+".png"		cv.imwrite(self.name, self.draw)				cv.destroyAllWindows()				